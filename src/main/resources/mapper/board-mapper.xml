<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.kahyun.mapper.BoardMapper">

    <!-- 게시판 리스트 -->
    <select id="getBoardList" parameterType="BoardVo" resultType="BoardVo">
        SELECT
            seq,
            title,
            content,
            nickname,
            create_dt,
            update_dt,
            boardOption,
            view,
            ROW_NUMBER() over(ORDER BY create_dt DESC) AS rownum
        FROM board
        WHERE status = 'N'
        ORDER BY create_dt DESC
    </select>

    <!-- 게시판 글 쓰기 -->
    <insert id="createBoard" parameterType="BoardVo">
        INSERT INTO board
            (title, nickname, content, create_dt, user_seq, boardOption)
        VALUES (#{title}, #{nickname}, #{content}, CURRENT_TIME(), #{user_seq}, #{boardOption})
    </insert>

    <!-- 게시글 삭제 -->
    <update id="deleteBoard" parameterType="String">
        UPDATE board
        SET status = 'D'
        WHERE seq = #{seq}
    </update>

    <!-- 게시글 상세 -->
    <select id="getBoardDetail" parameterType="BoardVo" resultType="BoardVo">
        SELECT * FROM board WHERE seq = #{seq}
    </select>

    <!-- 조회수 증가 -->
    <update id="upView" parameterType="BoardVo">
        update board set view = view+1 where seq = #{seq}
    </update>

    <!-- 게시판 리스트 상단 공지사항 표시 -->
    <select id="selectBoardNotice" resultType="com.example.kahyun.vo.NoticeBoardVo">
        SELECT
            ROW_NUMBER() over(ORDER BY nb.importance, nb.update_dt DESC, nb.create_dt DESC) AS rownum,
                nb.*,
            users.nickname
        FROM notice_board AS nb
                 INNER JOIN users users ON users.seq = nb.user_seq
        WHERE nb.delete_yn = 'N' AND nb.board_yn = 'Y'
        ORDER BY nb.importance, nb.update_dt DESC, nb.create_dt DESC
    </select>
</mapper>